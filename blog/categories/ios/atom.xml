<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ios | ç‹è‹¥é£çš„å°çª]]></title>
  <link href="http://wangruofeng.github.io/blog/categories/ios/atom.xml" rel="self"/>
  <link href="http://wangruofeng.github.io/"/>
  <updated>2016-01-13T05:06:51+08:00</updated>
  <id>http://wangruofeng.github.io/</id>
  <author>
    <name><![CDATA[Ace]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[iOSä¸­çš„è§¦æ‘¸äº‹ä»¶å’Œæ‰‹åŠ¿å¤„ç†]]></title>
    <link href="http://wangruofeng.github.io/blog/2016/01/13/ioszhong-de-hong-mo-shi-jian-he-shou-shi-chu-li/"/>
    <updated>2016-01-13T05:05:09+08:00</updated>
    <id>http://wangruofeng.github.io/blog/2016/01/13/ioszhong-de-hong-mo-shi-jian-he-shou-shi-chu-li</id>
    <content type="html"><![CDATA[<h3>iOSè§¦æ‘¸äº‹ä»¶åˆ†ç±»</h3>

<ul>
<li>è§¦æ‘¸äº‹ä»¶</li>
<li>åŠ é€Ÿäº‹ä»¶</li>
<li>è¿œç¨‹äº‹ä»¶</li>
</ul>


<h3>è°èƒ½å¤„ç†è§¦æ‘¸äº‹ä»¶?</h3>

<p><strong>å“åº”è€…å¯¹è±¡</strong></p>

<p>åœ¨iOSä¸­ä¸æ˜¯ä»»ä½•å¯¹è±¡éƒ½èƒ½å¤„ç†äº‹ä»¶,åªæœ‰ç»§æ‰¿äº†UIResponderçš„å¯¹è±¡æ‰èƒ½æ¥æ”¶å¹¶å¤„ç†äº‹ä»¶.æˆ‘ä»¬ç§°ä¹‹ä¸º<strong>å“åº”è€…å¯¹è±¡</strong>.</p>

<p><code>UIApplication</code>,<code>UIViewController</code>,<code>UIView</code>éƒ½ç»§æ‰¿è‡ª<code>UIResponder</code>,å› æ­¤å®ƒä»¬éƒ½æ˜¯å“åº”è€…å¯¹è±¡,éƒ½èƒ½å¤Ÿæ¥æ”¶å¹¶å¤„ç†äº‹ä»¶.</p>

<h3>UIResponder</h3>

<p>UIResponderå†…éƒ¨æä¾›äº†æ–¹æ³•æ¥å¤„ç†äº‹ä»¶</p>

<ol>
<li><p>è§¦æ‘¸äº‹ä»¶</p>

<p> ä¸€æ¬¡å®Œæˆçš„è§¦æ‘¸è¿‡ç¨‹,ä¼šç»å†3ä¸ªçŠ¶æ€;
 UIViewçš„è§¦æ‘¸äº‹ä»¶å¤„ç†</p>

<p> 1.ä¸€æ ¹æˆ–å¤šæ ¹æ‰‹æŒ‡å¼€å§‹è§¦æ‘¸view,ç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨viewä¸‹é¢çš„æ–¹æ³•:</p>

<pre><code> - (void)touchesBegan:(NSSet *)touches withEvent:(UIEvent *)event;  //è§¦æ‘¸å¼€å§‹
</code></pre>

 2.ä¸€æ ¹æˆ–è€…å¤šæ ¹æ‰‹æŒ‡åœ¨viewä¸Šç§»åŠ¨ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨viewä¸‹é¢çš„æ–¹æ³•ï¼ˆéšç€æ‰‹æŒ‡çš„ç§»åŠ¨ï¼Œä¼šæŒç»­è°ƒç”¨è¯¥æ–¹æ³•ï¼‰

<pre><code> - (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event;  //è§¦æ‘¸ç§»åŠ¨
</code></pre>

 3.ä¸€æ ¹æˆ–è€…å¤šæ ¹æ‰‹æŒ‡ç¦»å¼€viewï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨viewä¸‹é¢çš„æ–¹æ³•

<pre><code> - (void)touchesEnded:(NSSet *)touches withEvent:(UIEvent *)event;  //è§¦æ‘¸ç»“æŸ
</code></pre>

 4.è§¦æ‘¸ç»“æŸå‰ï¼ŒæŸä¸ªç³»ç»Ÿäº‹ä»¶ï¼ˆä¾‹å¦‚ç”µè¯å‘¼å…¥ ï¼‰ä¼šæ‰“æ–­è§¦æ‘¸è¿‡ç¨‹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒç”¨viewä¸‹é¢çš„æ–¹æ³•

<pre><code> - (void)touchesCancelled:(NSSet *)touches withEvent:(UIEvent *)event; //è§¦æ‘¸å–æ¶ˆ(å¯èƒ½ä¼šç»å†)
</code></pre>

 4ä¸ªè§¦æ‘¸äº‹ä»¶çš„å¤„ç†æ–¹æ³•ä¸­ï¼Œéƒ½æœ‰ NSSet <em>touches å’Œ UIEvent </em>event ä¸¤ä¸ªå‚æ•°:

<ul>
<li>ä¸€æ¬¡å®Œæ•´çš„è§¦æ‘¸è¿‡ç¨‹ï¼Œåªä¼šäº§ç”Ÿä¸€ä¸ªäº‹ä»¶å¯¹è±¡ï¼Œ4ä¸ªè§¦æ‘¸æ–¹æ³•éƒ½æ˜¯åŒä¸€ä¸ªeventå‚æ•°</li>
<li>å¦‚æœä¸¤æ ¹æ‰‹æŒ‡åŒæ—¶è§¦æ‘¸ä¸€ä¸ªviewï¼Œé‚£ä¹ˆviewåªä¼šè°ƒç”¨ä¸€æ¬¡ touchesBegan:withEvent: æ–¹æ³•ï¼Œtoucheså‚æ•°ä¸­è£…ç€ä¸¤ä¸ªUITouchå¯¹è±¡ï¼›</li>
<li>å¦‚æœè¿™ä¸¤æ ¹æ‰‹æŒ‡ä¸€å‰ä¸€ååˆ†å¼€è§¦æ‘¸åŒä¸€ä¸ªviewï¼Œé‚£ä¹ˆviewä¼šåˆ†åˆ«è°ƒç”¨ä¸¤æ¬¡ touchesBegan:withEvent:æ–¹æ³•ï¼Œ å¹¶ä¸”æ¯æ¬¡è°ƒç”¨æ—¶çš„toucheså‚æ•°åªåŒ…å«ä¸€ä¸ªUITouchå¯¹è±¡ï¼›</li>
<li>æ ¹æ®touchesä¸­UITouchä¸ªæ•°å¯ä»¥åˆ¤æ–­å‡ºä½¿å•ç‚¹è§¦æ‘¸è¿˜æ˜¯å¤šç‚¹è§¦æ‘¸</li>
</ul>


<p> æç¤ºï¼štouchesä¸­å­˜æ”¾çš„éƒ½æ˜¯UITouchå¯¹è±¡ã€‚</p></li>
<li><p>åŠ é€Ÿè®¡äº‹ä»¶</p>

<pre><code> - (void)motionBegan:(UIEventSubtype)motion withEvent:(UIEvent *)event;
 - (void)motionEnded:(UIEventSubtype)motion withEvent:(UIEvent *)event;
 - (void)motionCancelled:(UIEventSubtype)motion withEvent:(UIEvent *)event;
</code></pre></li>
<li><p>è¿œç¨‹æ§åˆ¶äº‹ä»¶</p>

<pre><code> - (void)remoteControlReceivedWithEvent:(UIEvent *)event;
</code></pre></li>
</ol>


<h3>UITouch</h3>

<p>å½“ç”¨æˆ·ç”¨ä¸€æ ¹æ‰‹æŒ‡è§¦æ‘¸å±å¹•æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ªä¸æ‰‹æŒ‡ç›¸å…³è”çš„UITouchå¯¹è±¡ï¼›ä¸€æ ¹æ‰‹æŒ‡å¯¹åº”ä¸€ä¸ªUITouchå¯¹è±¡
UITouchçš„ä½œç”¨:</p>

<ul>
<li>ä¿å­˜è·Ÿæ‰‹æŒ‡ç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è§¦æ‘¸çš„ä½ç½®ã€æ—¶é—´ã€é˜¶æ®µï¼›</li>
<li>å½“æ‰‹æŒ‡ç§»åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šæ›´æ–°åŒä¸€ä¸ªUITouchå¯¹è±¡ï¼Œä½¿ä¹‹èƒ½å¤Ÿä¸€ç›´ä¿å­˜è¯¥æ‰‹æŒ‡çš„è§¦æ‘¸ä½ç½®ï¼›</li>
<li>å½“æ‰‹æŒ‡ç¦»å¼€å±å¹•æ—¶ï¼Œç³»ç»Ÿä¼šé”€æ¯ç›¸åº”çš„UITouchå¯¹è±¡ã€‚</li>
</ul>


<p>æç¤ºï¼šiPhoneå¼€å‘ä¸­ï¼Œè¦é¿å…ä½¿ç”¨åŒå‡»äº‹ä»¶ã€‚</p>

<p>UITouchçš„å±æ€§:
è§¦æ‘¸äº§ç”Ÿæ—¶æ‰€å¤„çš„çª—å£:</p>

<pre><code>@property(nonatomic,readonly,retain) UIWindow *window;
</code></pre>

<p>è§¦æ‘¸äº§ç”Ÿæ—¶æ‰€å¤„çš„è§†å›¾</p>

<pre><code> @property(nonatomic,readonly,retain) UIView *view;
</code></pre>

<p>çŸ­æ—¶é—´å†…ç‚¹æŒ‰å±å¹•çš„æ¬¡æ•°ï¼Œå¯ä»¥æ ¹æ®tapCountåˆ¤æ–­å•å‡»ã€åŒå‡»æˆ–æ›´å¤šåœ°ç‚¹å‡»</p>

<pre><code> @property(nonatomic,readonly) NSUInteger tapCount;
</code></pre>

<p>è®°å½•äº†è§¦æ‘¸äº‹ä»¶äº§ç”Ÿæˆ–å˜åŒ–æ—¶çš„æ—¶é—´ï¼Œå•ä½æ˜¯ç§’</p>

<pre><code> @property(nonatomic,readonly) NSTimeInterval timestamp;
</code></pre>

<p>å½“å‰è§¦æ‘¸äº‹ä»¶æ‰€å¤„çš„çŠ¶æ€</p>

<pre><code>@property(nonatomic,readonly) UITouchPhase phase;
/*
UITouchPhaseæ˜¯ä¸€ä¸ªæšä¸¾ç±»å‹ï¼ŒåŒ…å«ï¼š
UITouchPhaseBeganï¼ˆè§¦æ‘¸å¼€å§‹ï¼‰
UITouchPhaseMovedï¼ˆæ¥è§¦ç‚¹ç§»åŠ¨ï¼‰
UITouchPhaseStationaryï¼ˆæ¥è§¦ç‚¹æ— ç§»åŠ¨ï¼‰
UITouchPhaseEndedï¼ˆè§¦æ‘¸ç»“æŸï¼‰
UITouchPhaseCancelledï¼ˆè§¦æ‘¸å–æ¶ˆï¼‰*/
</code></pre>

<p>UITouchçš„æ–¹æ³•ï¼š</p>

<pre><code>- (CGPoint)locationInView:(UIView *)view;
</code></pre>

<p>1.è¿”å›å€¼è¡¨ç¤ºè§¦æ‘¸åœ¨viewä¸Šçš„ä½ç½®ï¼›</p>

<p>2.è¿™é‡Œè¿”å›çš„ä½ç½®æ˜¯é’ˆå¯¹viewåæ ‡ç³»çš„,ï¼ˆä»¥viewçš„å·¦ä¸Šè§’ä¸ºåŸç‚¹ï¼ˆ0ï¼Œ0ï¼‰ï¼‰ï¼›</p>

<p>3.è°ƒç”¨æ—¶ä¼ å…¥çš„viewå‚æ•°ä¸ºnil çš„è¯ï¼Œè¿”å›çš„æ˜¯è§¦æ‘¸ç‚¹åœ¨UIWindowçš„ä½ç½®ã€‚</p>

<pre><code>- (CGPoint)previousLocationInView:(UIView *)view;
</code></pre>

<p>è¯¥æ–¹æ³•è®°å½•äº†å‰ä¸€ä¸ªè§¦æ‘¸ç‚¹çš„ä½ç½®ï¼›</p>

<h3>UIEvent</h3>

<blockquote><p>æ¯äº§ç”Ÿä¸€ä¸ªäº‹ä»¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªUIEventå¯¹è±¡ï¼›</p>

<p>UIEvent:ç§°ä¸ºäº‹ä»¶å¯¹è±¡ï¼Œè®°å½•äº‹ä»¶äº§ç”Ÿçš„æ—¶åˆ»å’Œç±»å‹ã€‚</p></blockquote>

<p>å¸¸è§å±æ€§ï¼š
1.äº‹ä»¶ç±»å‹</p>

<pre><code class="objective-c">@property(nonatomic,readonly) UIEventType  type;
@property(nonatomic,readonly) UIEventSubtype  subtype;

typedef
NS_ENUM(NSInteger, UIEventType) {
    UIEventTypeTouches,
    UIEventTypeMotion,
    UIEventTypeRemoteControl,
};
typedef
NS_ENUM(NSInteger, UIEventSubtype) {
    // available in iPhone OS 3.0
    UIEventSubtypeNone                              = 0,    
    // for UIEventTypeMotion, available in iPhone OS 3.0
    UIEventSubtypeMotionShake                       = 1,
    // for UIEventTypeRemoteControl, available in iOS 4.0
    UIEventSubtypeRemoteControlPlay                 = 100,
    UIEventSubtypeRemoteControlPause                = 101,
    UIEventSubtypeRemoteControlStop                 = 102,
    UIEventSubtypeRemoteControlTogglePlayPause      = 103,
    UIEventSubtypeRemoteControlNextTrack            = 104,  
    UIEventSubtypeRemoteControlPreviousTrack        = 105,
    UIEventSubtypeRemoteControlBeginSeekingBackward = 106,   
    UIEventSubtypeRemoteControlEndSeekingBackward   = 107,  
    UIEventSubtypeRemoteControlBeginSeekingForward  = 108,  
    UIEventSubtypeRemoteControlEndSeekingForward    = 109,
};
</code></pre>

<p>2.äº‹ä»¶äº§ç”Ÿçš„æ—¶é—´</p>

<pre><code>@property(nonatomic,readonly) NSTimeInterval  timestamp;
</code></pre>

<p> UIEventè¿˜æä¾›äº†ç›¸åº”çš„æ–¹æ³•å¯ä»¥è·å¾—åœ¨æŸä¸ªviewä¸Šé¢çš„è§¦æ‘¸å¯¹è±¡ï¼ˆUITouchï¼‰ã€‚</p>

<p> è§¦æ‘¸äº‹ä»¶çš„äº§ç”Ÿï¼š</p>

<ol>
<li><p>å‘ç”Ÿè§¦æ‘¸äº‹ä»¶åï¼Œç³»ç»Ÿä¼šå°†è¯¥äº‹ä»¶åŠ å…¥åˆ°ä¸€ä¸ªç”±UIApplicationç®¡ç†çš„äº‹ä»¶é˜Ÿåˆ—ä¸­ï¼›</p></li>
<li><p>UIApplicationä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å‡ºæœ€å‰é¢çš„äº‹ä»¶ï¼Œå¹¶å°†äº‹ä»¶åˆ†å‘ä¸‹å»ä»¥ä¾¿å¤„ç†ï¼Œé€šå¸¸ï¼Œå…ˆå‘é€äº‹ä»¶ç»™åº”ç”¨ç¨‹åºçš„ä¸»çª—å£ï¼ˆkeyWindowï¼‰ï¼›</p></li>
<li><p>ä¸»çª—å£ä¼šåœ¨è§†å›¾å±‚æ¬¡ç»“æ„ä¸­æ‰¾åˆ°ä¸€ä¸ªæœ€åˆé€‚çš„è§†å›¾æ§ä»¶æ¥å¤„ç†è§¦æ‘¸äº‹ä»¶ï¼Œè¿™ä¹Ÿæ˜¯æ•´ä¸ªäº‹ä»¶å¤„ç†è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼›</p></li>
<li><p>æ‰¾åˆ°åˆé€‚çš„è§†å›¾æ§ä»¶åï¼Œå°±ä¼šè°ƒç”¨è§†å›¾æ§ä»¶çš„touchesæ–¹æ³•æ¥åšå…·ä½“çš„äº‹ä»¶å¤„ç†ã€‚</p></li>
</ol>


<p>è§¦æ‘¸äº‹ä»¶çš„ä¼ é€’ï¼š</p>

<blockquote><p>è§¦æ‘¸äº‹ä»¶çš„ä¼ é€’æ˜¯ä»çˆ¶æ§ä»¶ä¼ é€’åˆ°å­æ§ä»¶ï¼›</p>

<p>å¦‚æœçˆ¶æ§ä»¶ä¸èƒ½æ¥æ”¶è§¦æ‘¸äº‹ä»¶ï¼Œé‚£ä¹ˆå­æ§ä»¶å°±ä¸å¯èƒ½æ¥æ”¶åˆ°è§¦æ‘¸äº‹ä»¶ã€‚</p></blockquote>

<p><img src="http://ww4.sinaimg.cn/mw690/64124373gw1eznrp087anj205t07rdfx.jpg" alt="è§¦æ‘¸äº‹ä»¶" />
<img src="http://ww2.sinaimg.cn/mw690/64124373gw1eznrrf36ymj2097077dhc.jpg" alt="è§¦æ‘¸äº‹ä»¶2" /></p>

<p>UIViewä¸æ¥æ”¶è§¦æ‘¸äº‹ä»¶çš„ä¸‰ç§æƒ…å†µ:
ä¸æ¥å—ç”¨æˆ·äº¤äº’ ï¼š</p>

<ol>
<li><p>userInteractionEnable = NO;</p></li>
<li><p>éšè— ï¼šhidden = YES;</p></li>
<li><p>é€æ˜ï¼šalpha = 0.0 ~ 0.01</p></li>
</ol>


<p>æç¤ºï¼šUIImageViewçš„userInteractionEnableé»˜è®¤å°±æ˜¯NOï¼Œå› æ­¤UIImageViewä»¥åŠå®ƒçš„å­æ§ä»¶é»˜è®¤æ˜¯ä¸èƒ½æ¥æ”¶è§¦æ‘¸äº‹ä»¶çš„ã€‚</p>

<p>è§¦æ‘¸äº‹ä»¶å¤„ç†çš„è¯¦ç»†è¿‡ç¨‹ï¼š</p>

<ol>
<li><p>ç”¨æˆ·ç‚¹å‡»å±å¹•åäº§ç”Ÿçš„ä¸€ä¸ªè§¦æ‘¸äº‹ä»¶ï¼Œç»è¿‡ä¸€äº›åˆ—çš„ä¼ é€’è¿‡ç¨‹åï¼Œä¼šæ‰¾åˆ°æœ€åˆé€‚çš„è§†å›¾æ§ä»¶æ¥å¤„ç†è¿™ä¸ªäº‹ä»¶</p></li>
<li><p>æ‰¾åˆ°æœ€åˆé€‚çš„è§†å›¾æ§ä»¶åï¼Œå°±ä¼šè°ƒç”¨æ§ä»¶çš„touchesæ–¹æ³•æ¥ä½œå…·ä½“çš„äº‹ä»¶å¤„ç†</p>

<p> touchesBeganâ€¦</p>

<p> touchesMovedâ€¦</p>

<p> touchedEndedâ€¦</p></li>
</ol>


<p>è¿™äº›touchesæ–¹æ³•çš„é»˜è®¤åšæ³•æ˜¯å°†äº‹ä»¶é¡ºç€å“åº”è€…é“¾æ¡å‘ä¸Šä¼ é€’ï¼Œå°†äº‹ä»¶äº¤ç»™ä¸Šä¸€ä¸ªå“åº”è€…è¿›è¡Œå¤„ç†</p>

<p>å“åº”è€…é“¾çš„äº‹ä»¶ä¼ é€’è¿‡ç¨‹ï¼š</p>

<ol>
<li><p>å¦‚æœviewçš„æ§åˆ¶å™¨å­˜åœ¨ï¼Œå°±ä¼ é€’ç»™æ§åˆ¶å™¨ï¼›å¦‚æœæ§åˆ¶å™¨ä¸å­˜åœ¨ï¼Œåˆ™å°†å…¶ä¼ é€’ç»™å®ƒçš„çˆ¶è§†å›¾ï¼›</p></li>
<li><p>åœ¨è§†å›¾å±‚æ¬¡ç»“æ„æœ€é¡¶çº§çš„è§†å›¾ï¼Œå¦‚æœä¹Ÿä¸èƒ½å¤„ç†æ”¶åˆ°çš„äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™windowå¯¹è±¡è¿›è¡Œå¤„ç†ã€‚</p></li>
<li><p>å¦‚æœwindowå¯¹è±¡ä¹Ÿä¸å¤„ç†ï¼Œåˆ™å…¶å°†äº‹ä»¶æˆ–æ¶ˆæ¯ä¼ é€’ç»™UIApplicationå¯¹è±¡ï¼›</p></li>
<li><p>å¦‚æœUIApplicationä¹Ÿä¸èƒ½å¤„ç†è¯¥äº‹ä»¶æˆ–æ¶ˆæ¯ï¼Œåˆ™å°†å…¶ä¸¢å¼ƒ</p></li>
</ol>


<h3>ç›‘å¬è§¦æ‘¸äº‹ä»¶çš„åšæ³•</h3>

<p>å¦‚æœæƒ³ç›‘å¬ä¸€ä¸ªviewä¸Šé¢çš„è§¦æ‘¸äº‹ä»¶ï¼Œä¹‹å‰çš„åšæ³•æ˜¯ï¼š</p>

<ol>
<li><p>è‡ªå®šä¹‰ä¸€ä¸ªviewï¼›</p></li>
<li><p>å®ç°viewçš„touchesæ–¹æ³•ï¼Œåœ¨æ–¹æ³•å†…éƒ¨å®ç°å…·ä½“å¤„ç†ä»£ç ã€‚</p>

<p> é€šè¿‡touchesæ–¹æ³•ç›‘å¬viewè§¦æ‘¸äº‹ä»¶ï¼Œæœ‰å¾ˆæ˜æ˜¾çš„å‡ ä¸ªç¼ºç‚¹ï¼š</p>

<ul>
<li><p>å¿…é¡»å¾—è‡ªå®šä¹‰viewï¼›</p></li>
<li><p>ç”±äºæ˜¯åœ¨viewå†…éƒ¨çš„touchesæ–¹æ³•ä¸­ç›‘å¬è§¦æ‘¸äº‹ä»¶ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹ï¼Œæ— æ³•è®©å…¶ä»–å¤–ç•Œå¯¹è±¡ç›‘å¬viewçš„è§¦æ‘¸äº‹ä»¶ï¼›</p></li>
<li><p>ä¸å®¹æ˜“åŒºåˆ†ç”¨æˆ·çš„å…·ä½“æ‰‹åŠ¿è¡Œä¸ºã€‚</p></li>
</ul>
</li>
</ol>


<p>iOS 3.2ä¹‹åï¼Œè‹¹æœæ¨å‡ºäº†æ‰‹åŠ¿è¯†åˆ«åŠŸèƒ½ï¼ˆGesture Recognizerï¼‰,åœ¨è§¦æ‘¸äº‹ä»¶å¤„ç†æ–¹é¢ï¼Œå¤§å¤§ç®€åŒ–äº†å¼€å‘è€…çš„å¼€å‘éš¾åº¦ã€‚</p>

<h3>UIGestureRescognizer</h3>

<p>ä¸ºäº†å®Œæˆæ‰‹åŠ¿è¯†åˆ«ï¼Œå¿…é¡»å€ŸåŠ©äºæ‰‹åŠ¿è¯†åˆ«å™¨ï¼šUIGestureRecognizer ã€‚</p>

<p>åˆ©ç”¨UIGestureRecognizer,èƒ½è½»æ¾è¯†åˆ«ç”¨æˆ·åœ¨æŸä¸ªviewä¸Šé¢åšçš„ä¸€äº›å¸¸è§æ‰‹åŠ¿ã€‚</p>

<p>UIGestureRecognizeræ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®šä¹‰äº†æ‰€æœ‰çš„æ‰‹åŠ¿åŸºæœ¬è¡Œä¸ºï¼Œä½¿ç”¨å®ƒçš„å­ç±»æ‰èƒ½å¤„ç†å…·ä½“çš„æ‰‹åŠ¿</p>

<ul>
<li>UITapGestureRecognizer(æ•²å‡»)</li>
<li>UIPinchGestureRecognizer(æåˆï¼Œç”¨äºç¼©æ”¾)</li>
<li>UIPanGestureRecognizer(æ‹–æ‹½)</li>
<li>UISwipeGestureRecognizer(è½»æ‰«)</li>
<li>UIRotationGestureRecognizer(æ—‹è½¬)</li>
<li>UILongPressGestureRecognizer(é•¿æŒ‰)</li>
</ul>


<p>æ¯ä¸€ä¸ªæ‰‹åŠ¿è¯†åˆ«å™¨çš„ç”¨æ³•éƒ½å·®ä¸å¤šï¼Œæ¯”å¦‚UITapGestureRecognizerçš„ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹:</p>

<ol>
<li><p>åˆ›å»ºæ‰‹åŠ¿è¯†åˆ«å™¨å¯¹è±¡ï¼›</p>

<p> UITapGestureRecognizer *tap = [[UITapGestureRecognizer alloc] init];</p></li>
<li><p>è®¾ç½®æ‰‹åŠ¿è¯†åˆ«å™¨å¯¹è±¡çš„å…·ä½“å±æ€§ï¼›</p>

<pre><code> // è¿ç»­æ•²å‡»2æ¬¡
 tap.numberOfTapsRequired = 2;
 // éœ€è¦2æ ¹æ‰‹æŒ‡ä¸€èµ·æ•²å‡»
 tap.numberOfTouchesRequired = 2;
</code></pre></li>
<li><p>æ·»åŠ æ‰‹åŠ¿è¯†åˆ«å™¨åˆ°å¯¹åº”çš„viewä¸Š</p>

<p> [self.iconView addGestureRecognizer:tap];</p></li>
<li><p>ç›‘å¬æ‰‹åŠ¿çš„è§¦å‘</p>

<p> [tap addTarget:self action:@selector(tapIconView:)];</p></li>
</ol>


<p>æ‰‹åŠ¿è¯†åˆ«çš„çŠ¶æ€</p>

<pre><code class="objective-c">typedef NS_ENUM(NSInteger, UIGestureRecognizerState) {
    // æ²¡æœ‰è§¦æ‘¸äº‹ä»¶å‘ç”Ÿï¼Œæ‰€æœ‰æ‰‹åŠ¿è¯†åˆ«çš„é»˜è®¤çŠ¶æ€
    UIGestureRecognizerStatePossible,
    // ä¸€ä¸ªæ‰‹åŠ¿å·²ç»å¼€å§‹ä½†å°šæœªæ”¹å˜æˆ–è€…å®Œæˆæ—¶
    UIGestureRecognizerStateBegan,
    // æ‰‹åŠ¿çŠ¶æ€æ”¹å˜
    UIGestureRecognizerStateChanged,
    // æ‰‹åŠ¿å®Œæˆ
    UIGestureRecognizerStateEnded,
    // æ‰‹åŠ¿å–æ¶ˆï¼Œæ¢å¤è‡³PossibleçŠ¶æ€
    UIGestureRecognizerStateCancelled,
    // æ‰‹åŠ¿å¤±è´¥ï¼Œæ¢å¤è‡³PossibleçŠ¶æ€
    UIGestureRecognizerStateFailed,
    // è¯†åˆ«åˆ°æ‰‹åŠ¿è¯†åˆ«
    UIGestureRecognizerStateRecognized = UIGestureRecognizerStateEnded
};
</code></pre>

<p>å‚è€ƒèµ„æ–™ï¼š<a href="http://my.oschina.net/aofe/blog/268749">å‚²é£å‡Œå¯’çš„åšå®¢</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[iOSé‡Œç¨‹ç¢‘äº‹ä»¶]]></title>
    <link href="http://wangruofeng.github.io/blog/2016/01/13/iosli-cheng-bei-shi-jian/"/>
    <updated>2016-01-13T04:46:48+08:00</updated>
    <id>http://wangruofeng.github.io/blog/2016/01/13/iosli-cheng-bei-shi-jian</id>
    <content type="html"><![CDATA[<blockquote><p>è®°å½•iOSå„ç§é‡è¦é‡Œç¨‹ç¢‘äº‹ä»¶</p></blockquote>

<h2>ç§æœ‰æˆå‘˜å˜é‡çš„å®ç°</h2>

<p>1.0æ—¶ä»£ï¼Œåœ¨.hæ–‡ä»¶é‡‡ç”¨<code>@private</code>å…³é”®è¯</p>

<pre><code>@interface ViewController : UIViewController {
    @private
    NSInteger _value;
}
</code></pre>

<p>2.0æ—¶ä»£ é€šè¿‡åœ¨.mæ–‡ä»¶é€šè¿‡<code>åŒ¿åCategory</code></p>

<pre><code>@interface ViewController ()

@property (nonatomic) NSInteger value;

@end
</code></pre>

<p>3.0æ—¶ä»£ 2013 å¹´çš„ WWDC å…è®¸åœ¨ .m çš„ <code>@implementation</code>ä¸­</p>

<pre><code>@implementation ViewController {
    NSInteger _value;
}
</code></pre>

<h2>ARCæ¨å‡º</h2>

<p>2011</p>

<h2>è‡ªåŠ¨ç”Ÿæˆgetterå’Œsetteræ–¹æ³•çš„<code>@synthesize</code></h2>

<p>2012</p>

<h2>iOS 2.1 to iOS 2.2 API Differences</h2>

<p>Added frameworks:</p>

<ul>
<li>AVFoundation</li>
</ul>


<h2>iOS 2.2 to iOS 3.0 API Differences</h2>

<p>Added frameworks:</p>

<ul>
<li>CoreData</li>
<li>ExternalAccessory</li>
<li>GameKit</li>
<li>MapKit</li>
<li>MessageUI</li>
<li>MobileCoreServices</li>
<li>StoreKit</li>
</ul>


<h2>iOS 3.2 to iOS 4.0 API Differences</h2>

<p>Added frameworks:</p>

<ul>
<li>Accelerate</li>
<li>AssetsLibrary</li>
<li>CoreMedia</li>
<li>CoreMotion</li>
<li>CoreTelephony</li>
<li>CoreVideo</li>
<li>EventKit</li>
<li>EventKitUI</li>
<li>iAd</li>
<li>ImageIO</li>
<li>QuickLook</li>
</ul>


<h2>iOS 4.3 to iOS 5.0 API Differences</h2>

<p>Added frameworks</p>

<ul>
<li>Accounts</li>
<li>CoreBluetooth</li>
<li>CoreImage</li>
<li>GLKit</li>
<li>GSS</li>
<li>NewsstandKit</li>
<li>Twitter</li>
</ul>


<h2>5.1 to iOS 6.0 API Differences</h2>

<p>Added frameworks</p>

<ul>
<li>AdSupport</li>
<li>MediaToolbox</li>
<li>PassKit</li>
<li>Social</li>
</ul>


<h2>6.1 to iOS 7.0 API Differences</h2>

<p>Added frameworks</p>

<ul>
<li>GameController</li>
<li>JavaScriptCore</li>
<li>MediaAccessibility</li>
<li>MultipeerConnectivity</li>
<li>SafariServices</li>
<li>SpriteKit</li>
</ul>


<h2>iOS 7.1 to iOS 8.0 API Differences</h2>

<p>Added frameworks</p>

<ul>
<li>Accelerate</li>
<li>Accounts</li>
<li>AddressBook</li>
<li>AddressBookUI</li>
<li>AudioToolbox</li>
<li>AudioUnit</li>
<li>AVFoundation</li>
<li>AVKit (Added)</li>
<li>CFNetwork</li>
<li>CloudKit (Added)</li>
<li>CoreAudio</li>
<li>CoreAudioKit (Added)</li>
<li>CoreAuthentication (Added)</li>
<li>CoreBluetooth</li>
<li>CoreData</li>
<li>CoreFoundation</li>
<li>CoreImage</li>
<li>CoreLocation</li>
<li>CoreMedia</li>
<li>CoreMotion</li>
<li>CoreText</li>
<li>CoreVideo</li>
<li>EventKit</li>
<li>EventKitUI</li>
<li>ExternalAccessory</li>
<li>Foundation</li>
<li>GameController</li>
<li>GameKit</li>
<li>GLKit</li>
<li>GSS</li>
<li>HealthKit (Added)</li>
<li>HomeKit (Added)</li>
<li>iAd</li>
<li>ImageIO</li>
<li>IOKit</li>
<li>JavaScriptCore</li>
<li>LocalAuthentication (Added)</li>
<li>MapKit</li>
<li>MediaAccessibility</li>
<li>MediaPlayer</li>
<li>MessageUI</li>
<li>Metal (Added)</li>
<li>MobileCoreServices</li>
<li>MultipeerConnectivity</li>
<li>NetworkExtension (Added)</li>
<li>NewsstandKit</li>
<li>NotificationCenter (Added)</li>
<li>OpenGLES</li>
<li>PassKit</li>
<li>Photos (Added)</li>
<li>PhotosUI (Added)</li>
<li>PushKit (Added)</li>
<li>QuartzCore</li>
<li>QuickLook</li>
<li>SceneKit (Added)</li>
<li>Security</li>
<li>Social</li>
<li>SpriteKit</li>
<li>StoreKit</li>
<li>UIKit</li>
<li>VideoToolbox</li>
<li>WebKit (Added)</li>
</ul>


<h2>iOS 8.3 to iOS 9.0 API Differences</h2>

<p>Added frameworks</p>

<p>Objective-C</p>

<ul>
<li>/usr/include</li>
<li>Accelerate</li>
<li>Accounts</li>
<li>AddressBook</li>
<li>AddressBookUI</li>
<li>AssetsLibrary</li>
<li>AudioToolbox</li>
<li>AudioUnit</li>
<li>AVFoundation</li>
<li>AVKit</li>
<li>CFNetwork</li>
<li>CloudKit</li>
<li>Contacts (Added)</li>
<li>ContactsUI (Added)</li>
<li>CoreAudio</li>
<li>CoreAudioKit</li>
<li>CoreBluetooth</li>
<li>CoreData</li>
<li>CoreFoundation</li>
<li>CoreGraphics</li>
<li>CoreImage</li>
<li>CoreLocation</li>
<li>CoreMedia</li>
<li>CoreMIDI</li>
<li>CoreMotion</li>
<li>CoreSpotlight (Added)</li>
<li>CoreTelephony</li>
<li>CoreText</li>
<li>CoreVideo</li>
<li>EventKit</li>
<li>EventKitUI</li>
<li>ExternalAccessory</li>
<li>Foundation</li>
<li>GameController</li>
<li>GameKit</li>
<li>GameplayKit (Added)</li>
<li>GLKit</li>
<li>GSS</li>
<li>HealthKit</li>
<li>HomeKit</li>
<li>iAd</li>
<li>ImageIO</li>
<li>JavaScriptCore</li>
<li>LocalAuthentication</li>
<li>MapKit</li>
<li>MediaPlayer</li>
<li>MediaToolbox</li>
<li>MessageUI</li>
<li>Metal</li>
<li>MetalKit (Added)</li>
<li>MetalPerformanceShaders (Added)</li>
<li>MobileCoreServices</li>
<li>ModelIO (Added)</li>
<li>MultipeerConnectivity</li>
<li>NetworkExtension</li>
<li>NewsstandKit</li>
<li>OpenAL</li>
<li>PassKit</li>
<li>Photos</li>
<li>PushKit</li>
<li>QuartzCore</li>
<li>QuickLook</li>
<li>ReplayKit (Added)</li>
<li>SafariServices</li>
<li>SceneKit</li>
<li>Security</li>
<li>SpriteKit</li>
<li>StoreKit</li>
<li>SystemConfiguration</li>
<li>UIKit</li>
<li>VideoToolbox</li>
<li>WatchConnectivity (Added)</li>
<li>WatchKit</li>
<li>WebKit</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[å¤šçº¿ç¨‹ä¹‹NSOperation]]></title>
    <link href="http://wangruofeng.github.io/blog/2016/01/13/duo-xian-cheng-zhi-nsoperation/"/>
    <updated>2016-01-13T04:40:17+08:00</updated>
    <id>http://wangruofeng.github.io/blog/2016/01/13/duo-xian-cheng-zhi-nsoperation</id>
    <content type="html"><![CDATA[<h3>æœ¬æ–‡ç›®å½•</h3>

<ul>
<li>å‰è¨€</li>
<li>1.NSInvocationOperation</li>
<li>2.NSBlokcOperation</li>
<li>3.NSOperationçš„å…¶ä»–ç”¨æ³•</li>
<li>4.è‡ªå®šä¹‰NSOperation</li>
</ul>


<h2>å‰è¨€</h2>

<p>1.è™½ç„¶<code>NSThread</code>ä¹Ÿå¯ä»¥å®ç°å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œä½†æ˜¯éœ€è¦æˆ‘ä»¬å»ç®¡ç†çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸï¼Œè¿˜è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ã€åŠ é”é—®é¢˜ï¼Œé€ æˆä¸€äº›æ€§èƒ½ä¸Šçš„å¼€é”€ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é…åˆä½¿ç”¨<code>NSOperation</code>å’Œ<code>NSOperationQueue</code>å®ç°å¤šçº¿ç¨‹ç¼–ç¨‹ï¼Œå®ç°æ­¥éª¤å¤§è‡´æ˜¯è¿™æ ·çš„</p>

<ul>
<li>å…ˆå°†éœ€è¦æ‰§è¡Œçš„æ“ä½œå°è£…åˆ°ä¸€ä¸ªNSOperationå¯¹è±¡ä¸­</li>
<li>ç„¶åå°†NSOperationå¯¹è±¡æ·»åŠ åˆ°NSOperationQueueä¸­</li>
<li>ç³»ç»Ÿä¼šè‡ªåŠ¨å°†<code>NSOperation</code>ä¸­å°è£…çš„æ“ä½œæ”¾åˆ°ä¸€æ¡æ–°çº¿ç¨‹ä¸­æ‰§è¡Œåœ¨æ­¤è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬æ ¹æœ¬ä¸ç”¨è€ƒè™‘çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸã€åŒæ­¥ã€åŠ é”ç­‰é—®é¢˜ä¸‹é¢åˆ—ä¸¾ä¸€ä¸ªåº”ç”¨åœºæ™¯ï¼Œæ¯”å¦‚å¾®åšçš„ç²‰ä¸åˆ—è¡¨ï¼š</li>
</ul>


<p><img src="http://images.cnitblog.com/blog/497279/201304/19122046-b40c752b60a5413290b569f5377ef7f3.png" alt="å¾®åšçš„ç²‰ä¸åˆ—è¡¨" /></p>

<p>æ¯ä¸€è¡Œçš„å¤´åƒè‚¯å®šè¦ä»æ–°æµªæœåŠ¡å™¨ä¸‹è½½å›¾ç‰‡åæ‰èƒ½æ˜¾ç¤ºçš„ï¼Œè€Œä¸”æ˜¯éœ€è¦å¼‚æ­¥ä¸‹è½½ã€‚è¿™æ—¶å€™ä½ å°±å¯ä»¥æŠŠæ¯ä¸€è¡Œçš„å›¾ç‰‡ä¸‹è½½æ“ä½œå°è£…åˆ°ä¸€ä¸ª<code>NSOperation</code>å¯¹è±¡ä¸­ï¼Œä¸Šé¢æœ‰6è¡Œï¼Œæ‰€ä»¥è¦åˆ›å»º6ä¸ª<code>NSOperation</code>å¯¹è±¡ï¼Œç„¶åæ·»åŠ åˆ°<code>NSOperationQueue</code>ä¸­ï¼Œåˆ†åˆ«ä¸‹è½½ä¸åŒçš„å›¾ç‰‡ï¼Œä¸‹è½½å®Œæ¯•åï¼Œå›åˆ°å¯¹åº”çš„è¡Œå°†å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥ã€‚</p>

<p>2 .é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>NSOperation</code>å¹¶ä¸å…·å¤‡å°è£…æ“ä½œçš„èƒ½åŠ›ï¼Œå¿…é¡»ä½¿ç”¨å®ƒçš„å­ç±»ï¼Œä½¿ç”¨NSOperationå­ç±»çš„æ–¹å¼æœ‰3ç§ï¼š</p>

<ul>
<li>NSInvocationOperation</li>
<li>NSBlockOperation</li>
<li>è‡ªå®šä¹‰å­ç±»ç»§æ‰¿NSOperationï¼Œå®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•</li>
</ul>


<p>è¿™è®²å…ˆä»‹ç»å¦‚ä½•ç”¨<code>NSOperation</code>å°è£…ä¸€ä¸ªæ“ä½œï¼Œåé¢å†ç»“åˆ<code>NSOperationQueue</code>æ¥ä½¿ç”¨ã€‚</p>

<h2>1.NSInvocationOperation</h2>

<pre><code class="objective-c">NSInvocationOperation *operation = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(run:) object:@"mj"];
[operation start];
</code></pre>

<ul>
<li>ç¬¬1è¡Œåˆå§‹åŒ–äº†ä¸€ä¸ª<code>NSInvocationOperation</code>å¯¹è±¡ï¼Œå®ƒæ˜¯åŸºäºä¸€ä¸ªå¯¹è±¡å’Œselectoræ¥åˆ›å»ºæ“ä½œ</li>
<li>ç¬¬2è¡Œè°ƒç”¨äº†startæ–¹æ³•ï¼Œç´§æ¥ç€ä¼šé©¬ä¸Šæ‰§è¡Œå°è£…å¥½çš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¼šè°ƒç”¨selfçš„run:æ–¹æ³•ï¼Œå¹¶ä¸”å°†@&ldquo;mj"ä½œä¸ºæ–¹æ³•å‚æ•°</li>
<li>è¿™é‡Œè¦æ³¨æ„ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œè°ƒç”¨äº†startæ–¹æ³•åå¹¶ä¸ä¼šå¼€ä¸€æ¡æ–°çº¿ç¨‹å»æ‰§è¡Œæ“ä½œï¼Œè€Œæ˜¯åœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œæ“ä½œã€‚åªæœ‰å°†operationæ”¾åˆ°ä¸€ä¸ªNSOperationQueueä¸­ï¼Œæ‰ä¼šå¼‚æ­¥æ‰§è¡Œæ“ä½œã€‚</li>
</ul>


<h2>2.NSBlockOperation</h2>

<h3>a.åŒæ­¥æ‰§è¡Œä¸€ä¸ªæ“ä½œ</h3>

<pre><code class="objective-c">NSBlockOperation *operation = [NSBlockOperation blockOperationWithBlock:^(){
         NSLog(@"æ‰§è¡Œäº†ä¸€ä¸ªæ–°çš„æ“ä½œ");
 }];
  // å¼€å§‹æ‰§è¡Œä»»åŠ¡
[operation start];
</code></pre>

<ul>
<li>ç¬¬1è¡Œåˆå§‹åŒ–äº†ä¸€ä¸ªNSBlockOperationå¯¹è±¡ï¼Œå®ƒæ˜¯ç”¨ä¸€ä¸ªBlockæ¥å°è£…éœ€è¦æ‰§è¡Œçš„æ“ä½œ</li>
<li>ç¬¬2è¡Œè°ƒç”¨äº†startæ–¹æ³•ï¼Œç´§æ¥ç€ä¼šé©¬ä¸Šæ‰§è¡ŒBlockä¸­çš„å†…å®¹</li>
<li>è¿™é‡Œè¿˜æ˜¯åœ¨å½“å‰çº¿ç¨‹åŒæ­¥æ‰§è¡Œæ“ä½œï¼Œå¹¶æ²¡æœ‰å¼‚æ­¥æ‰§è¡Œ</li>
</ul>


<h3>b.å¹¶å‘æ‰§è¡Œå¤šä¸ªæ“ä½œ</h3>

<pre><code class="objective-c">NSBlockOperation *operation = [NSBlockOperation blockOperationWithBlock:^(){
ã€€ã€€NSLog(@"æ‰§è¡Œç¬¬1æ¬¡æ“ä½œï¼Œçº¿ç¨‹ï¼š%@", [NSThread currentThread]);
}];

[operation addExecutionBlock:^() {
ã€€ã€€NSLog(@"åˆæ‰§è¡Œäº†1ä¸ªæ–°çš„æ“ä½œï¼Œçº¿ç¨‹ï¼š%@", [NSThread currentThread]);
}];

[operation addExecutionBlock:^() {
ã€€ã€€NSLog(@"åˆæ‰§è¡Œäº†1ä¸ªæ–°çš„æ“ä½œï¼Œçº¿ç¨‹ï¼š%@", [NSThread currentThread]);
}];

[operation addExecutionBlock:^() {
ã€€ã€€NSLog(@"åˆæ‰§è¡Œäº†1ä¸ªæ–°çš„æ“ä½œï¼Œçº¿ç¨‹ï¼š%@", [NSThread currentThread]);
}];

// å¼€å§‹æ‰§è¡Œä»»åŠ¡
[operation start];
</code></pre>

<ul>
<li>ç¬¬1è¡Œåˆå§‹åŒ–äº†ä¸€ä¸ªNSBlockOperationå¯¹è±¡</li>
<li>åˆ†åˆ«åœ¨ç¬¬5ã€9ã€13è¡Œé€šè¿‡addExecutionBlock:æ–¹æ³•æ·»åŠ äº†æ–°çš„æ“ä½œï¼ŒåŒ…æ‹¬ç¬¬1è¡Œçš„æ“ä½œï¼Œä¸€å…±å°è£…äº†4ä¸ªæ“ä½œ</li>
<li><p>åœ¨ç¬¬18è¡Œè°ƒç”¨startæ–¹æ³•åï¼Œå°±ä¼šå¹¶å‘åœ°æ‰§è¡Œè¿™4ä¸ªæ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¼šåœ¨ä¸åŒçº¿ç¨‹ä¸­æ‰§è¡Œ</p>

<pre><code>  1 2013-02-02 21:38:46.102 thread[4602:c07] åˆæ‰§è¡Œäº†1ä¸ªæ–°çš„æ“ä½œï¼Œçº¿ç¨‹ï¼š&lt;NSThread: 0x7121d50&gt;{name = (null), num = 1}
  2 2013-02-02 21:38:46.102 thread[4602:3f03] åˆæ‰§è¡Œäº†1ä¸ªæ–°çš„æ“ä½œï¼Œçº¿ç¨‹ï¼š&lt;NSThread: 0x742e1d0&gt;{name = (null), num = 5}
  3 2013-02-02 21:38:46.102 thread[4602:1b03] æ‰§è¡Œç¬¬1æ¬¡æ“ä½œï¼Œçº¿ç¨‹ï¼š&lt;NSThread: 0x742de50&gt;{name = (null), num = 3}
  4 2013-02-02 21:38:46.102 thread[4602:1303] åˆæ‰§è¡Œäº†1ä¸ªæ–°çš„æ“ä½œï¼Œçº¿ç¨‹ï¼š&lt;NSThread: 0x7157bf0&gt;{name = (null), num = 4}
</code></pre></li>
</ul>


<p>å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ªæ“ä½œæ‰€åœ¨çº¿ç¨‹çš„numå€¼éƒ½ä¸ä¸€æ ·ï¼Œè¯´æ˜æ˜¯ä¸åŒçº¿ç¨‹</p>

<h2>3.NSOperationçš„å…¶ä»–ç”¨æ³•</h2>

<h3>a.å–æ¶ˆæ“ä½œ</h3>

<p>operationå¼€å§‹æ‰§è¡Œä¹‹å, é»˜è®¤ä¼šä¸€ç›´æ‰§è¡Œæ“ä½œç›´åˆ°å®Œæˆï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è°ƒç”¨cancelæ–¹æ³•ä¸­é€”å–æ¶ˆæ“ä½œ</p>

<pre><code>[operation cancel];
</code></pre>

<h3>b.åœ¨æ“ä½œå®Œæˆååšä¸€äº›äº‹æƒ…</h3>

<p>å¦‚æœæƒ³åœ¨ä¸€ä¸ªNSOperationæ‰§è¡Œå®Œæ¯•ååšä¸€äº›äº‹æƒ…ï¼Œå°±è°ƒç”¨NSOperationçš„setCompletionBlockæ–¹æ³•æ¥è®¾ç½®æƒ³åšçš„äº‹æƒ…</p>

<pre><code>operation.completionBlock = ^() {
    NSLog(@"æ‰§è¡Œå®Œæ¯•");
};
</code></pre>

<p>å½“operationå°è£…çš„æ“ä½œæ‰§è¡Œå®Œæ¯•åï¼Œå°±ä¼šå›è°ƒBlocké‡Œé¢çš„å†…å®¹</p>

<h2>4.è‡ªå®šä¹‰NSOperation</h2>

<p>å¦‚æœ<code>NSInvocationOperation</code>å’Œ<code>NSBlockOperation</code>ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æ–°å»ºå­ç±»ç»§æ‰¿NSOperationï¼Œå¹¶æ·»åŠ ä»»ä½•éœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚å¦‚æœåªæ˜¯ç®€å•åœ°è‡ªå®šä¹‰NSOperationï¼Œåªéœ€è¦é‡è½½<code>-(void)main</code>è¿™ä¸ªæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢æ·»åŠ éœ€è¦æ‰§è¡Œçš„æ“ä½œã€‚</p>

<p>ä¸‹é¢å†™ä¸ªå­ç±»DownloadOperationæ¥ä¸‹è½½å›¾ç‰‡</p>

<h3>a.ç»§æ‰¿NSOperationï¼Œé‡å†™mainæ–¹æ³•</h3>

<p><em>DownloadOperation.h</em>
```objective-c</p>

<h1>import &lt;Foundation/Foundation.h></h1>

<p>@protocol DownloadOperationDelegate;</p>

<p>@interface DownloadOperation : NSOperation
// å›¾ç‰‡çš„urlè·¯å¾„
@property (nonatomic, copy) NSString *imageUrl;
// ä»£ç†
@property (nonatomic, assign) id<DownloadOperationDelegate> delegate;</p>

<ul>
<li>(id)initWithUrl:(NSString *)url delegate:(id<DownloadOperationDelegate>)delegate;
@end</li>
</ul>


<p>// å›¾ç‰‡ä¸‹è½½çš„åè®®
@protocol DownloadOperationDelegate <NSObject>
- (void)downloadFinishWithImage:(UIImage *)image;
@end
```</p>

<p>*DownloadOperation.m
*</p>

<pre><code class="objective-c">#import "DownloadOperation.h"

@implementation DownloadOperation
@synthesize delegate = _delegate;
@synthesize imageUrl = _imageUrl;

// åˆå§‹åŒ–
- (id)initWithUrl:(NSString *)url delegate:(id&lt;DownloadOperationDelegate&gt;)delegate {
    if (self = [super init]) {
        self.imageUrl = url;
        self.delegate = delegate;
    }
    return self;
}
// é‡Šæ”¾å†…å­˜
- (void)dealloc {
    [super dealloc];
    [_imageUrl release];
}

// æ‰§è¡Œä¸»ä»»åŠ¡
- (void)main {
    // æ–°å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¦‚æœæ˜¯å¼‚æ­¥æ‰§è¡Œæ“ä½œï¼Œé‚£ä¹ˆå°†æ— æ³•è®¿é—®åˆ°ä¸»çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± 
    @autoreleasepool {
        // ....
    }
}
@end
</code></pre>

<ul>
<li>åœ¨ç¬¬22è¡Œé‡è½½äº†mainæ–¹æ³•ï¼Œç­‰ä¼šå°±æŠŠä¸‹è½½å›¾ç‰‡çš„ä»£ç å†™åˆ°è¿™ä¸ªæ–¹æ³•ä¸­</li>
<li>å¦‚æœè¿™ä¸ªDownloadOperationæ˜¯åœ¨å¼‚æ­¥çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œä¹Ÿå°±æ˜¯è¯´mainæ–¹æ³•åœ¨å¼‚æ­¥çº¿ç¨‹è°ƒç”¨ï¼Œé‚£ä¹ˆå°†æ— æ³•è®¿é—®ä¸»çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œæ‰€ä»¥åœ¨ç¬¬24è¡Œåˆ›å»ºäº†ä¸€ä¸ªå±äºå½“å‰çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± </li>
</ul>


<h3>b.æ­£ç¡®å“åº”å–æ¶ˆäº‹ä»¶</h3>

<ul>
<li>é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªNSOperationå¼€å§‹æ‰§è¡Œä¹‹åï¼Œä¼šä¸€ç›´æ‰§è¡Œä»»åŠ¡åˆ°ç»“æŸï¼Œå°±æ¯”å¦‚ä¸Šé¢çš„DownloadOperationï¼Œé»˜è®¤ä¼šæ‰§è¡Œå®Œmainæ–¹æ³•ä¸­çš„æ‰€æœ‰ä»£ç </li>
<li>NSOperationæä¾›äº†ä¸€ä¸ªcancelæ–¹æ³•ï¼Œå¯ä»¥å–æ¶ˆå½“å‰çš„æ“ä½œã€‚</li>
<li>å¦‚æœæ˜¯è‡ªå®šä¹‰NSOperationçš„è¯ï¼Œéœ€è¦æ‰‹åŠ¨å¤„ç†è¿™ä¸ªå–æ¶ˆäº‹ä»¶ã€‚æ¯”å¦‚ï¼Œä¸€æ—¦è°ƒç”¨äº†cancelæ–¹æ³•ï¼Œåº”è¯¥é©¬ä¸Šç»ˆæ­¢mainæ–¹æ³•çš„æ‰§è¡Œï¼Œå¹¶åŠæ—¶å›æ”¶ä¸€äº›èµ„æºã€‚</li>
<li>å¤„ç†å–æ¶ˆäº‹ä»¶çš„å…·ä½“åšæ³•æ˜¯ï¼šåœ¨<code>main</code>æ–¹æ³•ä¸­å®šæœŸåœ°è°ƒç”¨<code>isCancelled</code>æ–¹æ³•æ£€æµ‹æ“ä½œæ˜¯å¦å·²ç»è¢«å–æ¶ˆï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¦è°ƒç”¨äº†<code>cancel</code>æ–¹æ³•ï¼Œå¦‚æœè¿”å›YESï¼Œè¡¨ç¤ºå·²å–æ¶ˆï¼Œåˆ™ç«‹å³è®©mainæ–¹æ³•è¿”å›ã€‚</li>
<li>ä»¥ä¸‹åœ°æ–¹å¯èƒ½éœ€è¦è°ƒç”¨<code>isCancelled</code>æ–¹æ³•:

<ol>
<li>åœ¨æ‰§è¡Œä»»ä½•å®é™…çš„å·¥ä½œä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯åœ¨mainæ–¹æ³•çš„å¼€å¤´ã€‚å› ä¸ºå–æ¶ˆå¯èƒ½å‘ç”Ÿåœ¨ä»»ä½•æ—¶å€™ï¼Œç”šè‡³åœ¨operationæ‰§è¡Œä¹‹å‰ã€‚</li>
<li>æ‰§è¡Œäº†ä¸€æ®µè€—æ—¶çš„æ“ä½œä¹‹åä¹Ÿéœ€è¦æ£€æµ‹æ“ä½œæ˜¯å¦å·²ç»è¢«å–æ¶ˆ</li>
</ol>
</li>
</ul>


<pre><code class="objective-c">- (void)main {
    // æ–°å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå¦‚æœæ˜¯å¼‚æ­¥æ‰§è¡Œæ“ä½œï¼Œé‚£ä¹ˆå°†æ— æ³•è®¿é—®åˆ°ä¸»çº¿ç¨‹çš„è‡ªåŠ¨é‡Šæ”¾æ± 
    @autoreleasepool {
        if (self.isCancelled) return;

        // è·å–å›¾ç‰‡æ•°æ®
        NSURL *url = [NSURL URLWithString:self.imageUrl];
        NSData *imageData = [NSData dataWithContentsOfURL:url];

        if (self.isCancelled) {
            url = nil;
            imageData = nil;
            return;
        }

        // åˆå§‹åŒ–å›¾ç‰‡
        UIImage *image = [UIImage imageWithData:imageData];

        if (self.isCancelled) {
            image = nil;
            return;
        }

        if ([self.delegate respondsToSelector:@selector(downloadFinishWithImage:)]) {
            // æŠŠå›¾ç‰‡æ•°æ®ä¼ å›åˆ°ä¸»çº¿ç¨‹
            [(NSObject *)self.delegate performSelectorOnMainThread:@selector(downloadFinishWithImage:) withObject:image waitUntilDone:NO];
        }
    }
}
</code></pre>

<ul>
<li>åœ¨ç¬¬4è¡Œmainæ–¹æ³•çš„å¼€å¤´å°±å…ˆåˆ¤æ–­operationæœ‰æ²¡æœ‰è¢«å–æ¶ˆã€‚å¦‚æœè¢«å–æ¶ˆäº†ï¼Œé‚£å°±æ²¡æœ‰å¿…è¦å¾€ä¸‹æ‰§è¡Œäº†</li>
<li>ç»è¿‡ç¬¬8è¡Œä¸‹è½½å›¾ç‰‡åï¼Œåœ¨ç¬¬10è¡Œä¹Ÿéœ€è¦åˆ¤æ–­æ“ä½œæœ‰æ²¡æœ‰è¢«å–æ¶ˆ</li>
<li>æ€»ä¹‹ï¼Œæ‰§è¡Œäº†ä¸€æ®µæ¯”è¾ƒè€—æ—¶çš„æ“ä½œä¹‹åï¼Œéƒ½éœ€è¦åˆ¤æ–­æ“ä½œæœ‰æ²¡æœ‰è¢«å–æ¶ˆ</li>
<li>å›¾ç‰‡ä¸‹è½½å®Œæ¯•åï¼Œåœ¨ç¬¬26è¡Œå°†å›¾ç‰‡æ•°æ®ä¼ é€’ç»™äº†ä»£ç†(delegate)å¯¹è±¡</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[ä¼˜é›…å¤„ç†UIImageå›¾ç‰‡æ—‹è½¬]]></title>
    <link href="http://wangruofeng.github.io/blog/2016/01/13/you-ya-chu-li-uiimagetu-pian-xuan-zhuan/"/>
    <updated>2016-01-13T04:38:49+08:00</updated>
    <id>http://wangruofeng.github.io/blog/2016/01/13/you-ya-chu-li-uiimagetu-pian-xuan-zhuan</id>
    <content type="html"><![CDATA[<h2>UIImagæ„é€ æ–¹å¼</h2>

<p>UIImagæ„é€ æ–¹å¼å¤§è‡´æœ‰4ç§æ–¹å¼
* ä»æœ¬åœ°bundleä¸­åŠ è½½ <code>imageNamed:</code>ï¼Œä¼ å…¥ä¸€ä¸ªbundleçš„æ–‡ä»¶åå³å¯
* ä»æœ¬åœ°ä¸€ä¸ªæ–‡ä»¶è·¯å¾„è¯»å– <code>imageWithContentsOfFile:</code>ï¼Œéœ€è¦ä¼ ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶è·¯å¾„path
* é€šè¿‡äºŒè¿›åˆ¶æ•°æ®<code>NSData</code>æ¥åˆ›å»º<code>imageWithData:</code>
* é€šè¿‡ä¸€ä¸ª<code>CoreGraphics</code>çš„<code>CGImageRef</code>æ¥åˆ›å»ºï¼Œ<code>initWithCGImage:</code>
* é€šè¿‡ä¸€ä¸ª<code>CoreImage</code>çš„<code>CIImage</code>æ¥åˆ›å»º<code>initWithCIImage</code></p>

<p>é€šè¿‡æŸ¥é˜…Appleå®˜ç½‘æ–‡æ¡£æˆ‘ä»¬å‘ç°æœ‰2ä¸ªè¿™æ ·çš„æ–¹æ³•ï¼Œä»Šå¤©å°±æ¥ä¸€æ¢ç©¶ç«Ÿ</p>

<pre><code class="objective-c">+ (UIImage *)imageWithCGImage:(CGImageRef)cgImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation NS_AVAILABLE_IOS(4_0);
+ (UIImage *)imageWithCIImage:(CIImage *)ciImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation NS_AVAILABLE_IOS(6_0);

- (instancetype)initWithCGImage:(CGImageRef)cgImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation NS_AVAILABLE_IOS(4_0);
- (instancetype)initWithCIImage:(CIImage *)ciImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation NS_AVAILABLE_IOS(6_0);
</code></pre>

<p>2ä¸ªç±»æ–¹æ³•2ä¸ªå®ä¾‹æ–¹æ³•éƒ½æ˜¯ç±»ä¼¼ï¼Œè¿™é‡Œä»¥<code>CGImageRef</code>ä¸ºä¾‹</p>

<pre><code class="objective-c">+ (UIImage *)imageWithCGImage:(CGImageRef)cgImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation NS_AVAILABLE_IOS(4_0);
</code></pre>

<ol>
<li>æ–°å»ºçš„Xcodeå·¥ç¨‹é€‰æ‹©single Application</li>
<li>åœ¨storyboardä¸­æ‹–ä¸€ä¸ª<code>UIImageView</code>è®¾ç½®å®ƒæ°´å¹³å‚ç›´å±…ä¸­å¯¹é½ï¼Œå®½å¸¦é«˜åº¦éšä¾¿è®¾ä¸€ä¸ªå€¼ä¸è¦å¤ªå¤§å°±è¡Œï¼Œè®¾ç½®<code>UIImageView</code>çš„<code>contentMode</code>ä¸º<code>Aspect Fit</code>æ–¹ä¾¿æŸ¥çœ‹ä»¥å…å˜å½¢</li>
<li>åœ¨<code>UIImageView</code>ä¸‹å‘æ”¾ä¸€ä¸ª<code>UIButton</code>æ§ä»¶æ–¹ä¾¿åé¢å¥½å¯¹å›¾ç‰‡è¿›è¡Œæ—‹è½¬æ“ä½œ</li>
<li><p>åœ¨viewControllerä¸­å»ºç«‹ä¸€ä¸ª<code>UIImageView</code>å¼•ç”¨,æ‹‰å‡ºä¸€ä¸ªrotateæŒ‰é’®çš„<code>IBAction</code></p>

<p> ç°åœ¨å¤§æ¦‚ç•Œé¢å¤§æ¦‚è¿™æ ·
 <img src="http://ww3.sinaimg.cn/mw690/64124373gw1ezhnagzyhpj20x7105doj.jpg" alt="UIImageOrientationæ•ˆæœå›¾" /></p></li>
<li><p>ä¸‹é¢æˆ‘ä»¬å®ç°
<code>- (IBAction)rotateImage:(id)sender {}</code>è¿™ä¸ªæ–¹æ³•</p>

<blockquote><p>åœ¨è¿™é‡Œæˆ‘ä»¬æƒ³é€šè¿‡ç‚¹å‡»æŒ‰é’®å®ç°å›¾ç‰‡æ—‹è½¬
  ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨æˆ‘ä»¬ä½¿ç”¨Categoryçš„æ–¹å¼å®ç°
  æ–°å»ºä¸€ä¸ªUIImageçš„åˆ†ç±»å–åå«Rotate</p>

<p>è¿™é‡Œéœ€è¦ä¼ ä¸€å¼ è¦å¤„ç†çš„å›¾ç‰‡å’Œä¸€ä¸ªå¾…å¤„ç†æˆçš„å›¾ç‰‡æ–¹å‘</p>

<pre><code class="``objective-c">  + (UIImage *)rotateImage:(UIImage *)oldImage
           orientation:(UIImageOrientation)orientation;
</code></pre></blockquote>

<pre><code class="``objective-c">  + (UIImage *)rotateImage:(UIImage *)oldImage orientation:(UIImageOrientation)orientation{

  UIImage *newImage = [UIImage imageWithCGImage:oldImage.CGImage scale:1 orientation:orientation];

  NSString *orientationStr = nil;
  switch (orientation) {
      case UIImageOrientationUp: {
          orientationStr = @"UIImageOrientationUp";
          break;
      }
      case UIImageOrientationDown: {
          orientationStr = @"UIImageOrientationDown";
          break;
      }
      case UIImageOrientationLeft: {
          orientationStr = @"UIImageOrientationLeft";
          break;
      }
      case UIImageOrientationRight: {
          orientationStr = @"UIImageOrientationRight";
          break;
      }
      case UIImageOrientationUpMirrored: {
          orientationStr = @"UIImageOrientationUpMirrored";
          break;
      }
      case UIImageOrientationDownMirrored: {
          orientationStr = @"UIImageOrientationDownMirrored";
          break;
      }
      case UIImageOrientationLeftMirrored: {
          orientationStr = @"UIImageOrientationLeftMirrored";
          break;
      }
      case UIImageOrientationRightMirrored: {
          orientationStr = @"UIImageOrientationRightMirrored";
          break;
      }

  }

  NSLog(@"current orientation: %@",orientationStr);

  return newImage;
}
</code></pre></li>
</ol>


<p>åœ¨buttonç‚¹å‡»äº‹ä»¶è§¦å‘æ—¶çš„è¿™æ ·ä½¿ç”¨</p>

<pre><code class="objective-c">- (IBAction)rotateImage:(id)sender {

    UIImage *oldImage = self.imgView.image;

    UIImage *rotatedImage = [UIImage rotateImage:oldImage orientation:UIImageOrientationLeft];

    self.imgView.image = rotatedImage;
}
</code></pre>

<p>ç‚¹å‡»æŒ‰é’®æµ‹è¯•å‘ç°ç¬¬ä¸€æ¬¡æ²¡é—®é¢˜ï¼Œä½†æ˜¯é‡é€¢ç‚¹å‡»æ— æ•ˆ
åŸæ¥<code>+ (UIImage *)imageWithCGImage:(CGImageRef)cgImage scale:(CGFloat)scale orientation:(UIImageOrientation)orientation</code>æ–¹æ³•æ‰§è¡ŒåŸç†æ˜¯æ‰§è¡Œå‰é€šè¿‡
<code>@property(nonatomic,readonly) UIImageOrientation imageOrientation;</code>æ¥å£å…ˆåˆ¤æ–­å½“å‰å›¾ç‰‡çš„æ–¹å‘æ˜¯å¦ä¸ºå°†è¦æ—‹è½¬çš„æ–¹å‘ï¼Œ
å¦‚æœæ˜¯å°±ç›´æ¥è¿”å›ä¸åšå¤„ç†ï¼Œå¦‚æœä¸æ˜¯å†ä½œæ—‹è½¬å¤„ç†ï¼Œ
ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–¹æ³•å¹¶æ²¡æœ‰å®é™…ä¸Šæ—‹è½¬imageçš„æ•°æ®ï¼Œåªæ˜¯ç”¨ä¸€ä¸ªæšä¸¾æ ‡è®°æ—‹è½¬çš„çŠ¶æ€</p>

<p>å¦‚æœæˆ‘ä»¬æƒ³æ¯æ¬¡æ—‹è½¬éœ€è¦ç›´æ¥æ”¹å˜åŸå§‹imageçš„æ•°æ®è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ
åœ¨è¿™é‡Œæˆ‘ä»¬é€šè¿‡<code>CGBitmapContext</code>,ä½¿ç”¨<code>CGContextRotateCTM</code>æ¥è®¾ç½®æ—‹è½¬ï¼Œ
å†æŠŠUIImageé€šè¿‡<code>drawInRect
</code>é‡æ–°ç»˜åˆ¶å‡ºæ¥ï¼Œé€šè¿‡<code>UIGraphicsGetImageFromCurrentImageContext</code>è·å¾—å¤„ç†åçš„å›¾ç‰‡
ä¸‹é¢æ˜¯å…·ä½“å®ç°</p>

<pre><code class="objective-c">- (UIImage *)fixedRotation{
    if (self.imageOrientation == UIImageOrientationUp) return self;
    CGAffineTransform transform = CGAffineTransformIdentity;

    switch (self.imageOrientation) {
        case UIImageOrientationDown:
        case UIImageOrientationDownMirrored:
            transform = CGAffineTransformTranslate(transform, self.size.width, self.size.height);
            transform = CGAffineTransformRotate(transform, M_PI);
            break;

        case UIImageOrientationLeft:
        case UIImageOrientationLeftMirrored:
            transform = CGAffineTransformTranslate(transform, self.size.width, 0);
            transform = CGAffineTransformRotate(transform, M_PI_2);
            break;

        case UIImageOrientationRight:
        case UIImageOrientationRightMirrored:
            transform = CGAffineTransformTranslate(transform, 0, self.size.height);
            transform = CGAffineTransformRotate(transform, -M_PI_2);
            break;
        case UIImageOrientationUp:
        case UIImageOrientationUpMirrored:
            break;
    }

    switch (self.imageOrientation) {
        case UIImageOrientationUpMirrored:
        case UIImageOrientationDownMirrored:
            transform = CGAffineTransformTranslate(transform, self.size.width, 0);
            transform = CGAffineTransformScale(transform, -1, 1);
            break;

        case UIImageOrientationLeftMirrored:
        case UIImageOrientationRightMirrored:
            transform = CGAffineTransformTranslate(transform, self.size.height, 0);
            transform = CGAffineTransformScale(transform, -1, 1);
            break;
        case UIImageOrientationUp:
        case UIImageOrientationDown:
        case UIImageOrientationLeft:
        case UIImageOrientationRight:
            break;
    }

    // Now we draw the underlying CGImage into a new context, applying the transform
    // calculated above.
    CGContextRef ctx = CGBitmapContextCreate(NULL, self.size.width, self.size.height,
                                             CGImageGetBitsPerComponent(self.CGImage), 0,
                                             CGImageGetColorSpace(self.CGImage),
                                             CGImageGetBitmapInfo(self.CGImage));
    CGContextConcatCTM(ctx, transform);
    switch (self.imageOrientation) {
        case UIImageOrientationLeft:
        case UIImageOrientationLeftMirrored:
        case UIImageOrientationRight:
        case UIImageOrientationRightMirrored:
            // Grr...
            CGContextDrawImage(ctx, CGRectMake(0,0,self.size.height,self.size.width), self.CGImage);
            break;

        default:
            CGContextDrawImage(ctx, CGRectMake(0,0,self.size.width,self.size.height), self.CGImage);
            break;
    }

    // And now we just create a new UIImage from the drawing context
    CGImageRef cgimg = CGBitmapContextCreateImage(ctx);
    UIImage *img = [UIImage imageWithCGImage:cgimg];
    CGContextRelease(ctx);
    CGImageRelease(cgimg);
    return img;

}
</code></pre>

<p>ç°åœ¨å†ä¼˜åŒ–ä¸€ä¸‹åŸæ¥<code>+ (UIImage *)rotateImage:(UIImage *)oldImage orientation:(UIImageOrientation)orientation</code> æ–¹æ³•,ä¿®æ”¹æˆè¿™æ ·
```objective-c
+ (UIImage <em>)rotateImage:(UIImage </em>)oldImage orientation:(UIImageOrientation)orientation{</p>

<pre><code>UIImage *newImage = [UIImage imageWithCGImage:oldImage.CGImage scale:1 orientation:orientation];

//fix original Image with gived orientation.
UIImage *fixedRotationImage = [newImage fixedRotation];

NSString *orientationStr = nil;
switch (orientation) {
    case UIImageOrientationUp: {
        orientationStr = @"UIImageOrientationUp";
        break;
    }
    case UIImageOrientationDown: {
        orientationStr = @"UIImageOrientationDown";
        break;
    }
    case UIImageOrientationLeft: {
        orientationStr = @"UIImageOrientationLeft";
        break;
    }
    case UIImageOrientationRight: {
        orientationStr = @"UIImageOrientationRight";
        break;
    }
    case UIImageOrientationUpMirrored: {
        orientationStr = @"UIImageOrientationUpMirrored";
        break;
    }
    case UIImageOrientationDownMirrored: {
        orientationStr = @"UIImageOrientationDownMirrored";
        break;
    }
    case UIImageOrientationLeftMirrored: {
        orientationStr = @"UIImageOrientationLeftMirrored";
        break;
    }
    case UIImageOrientationRightMirrored: {
        orientationStr = @"UIImageOrientationRightMirrored";
        break;
    }

}

NSLog(@"current orientation: %@",orientationStr);

return fixedRotationImage;
</code></pre>

<p>}
```
 ç°åœ¨å†æµ‹è¯•ä¸€ä¸‹ï¼Œwellï¼ŒItâ€˜s OKã€‚</p>

<p> have fun!!!</p>

<p>å‚è€ƒèµ„æ–™ï¼š
* <a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIImage_Class/#//apple_ref/c/tdef/UIImageOrientation">Apple-UIImage Class Reference</a>
* <a href="http://stackoverflow.com/questions/8915630/ios-uiimageview-how-to-handle-uiimage-image-orientation">ios-uiimageview-how-to-handle-uiimage-image-orientation</a>
* <a href="http://www.galloway.me.uk/2012/01/uiimageorientation-exif-orientation-sample-images/">UIImageOrientation / EXIF orientation sample images</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[åŠ¨ç”»ç»˜åˆ¶CAShapeLayerçš„è·¯å¾„CGPath]]></title>
    <link href="http://wangruofeng.github.io/blog/2016/01/13/dong-hua-hui-zhi-cashapelayerde-lu-jing-cgpath/"/>
    <updated>2016-01-13T04:35:42+08:00</updated>
    <id>http://wangruofeng.github.io/blog/2016/01/13/dong-hua-hui-zhi-cashapelayerde-lu-jing-cgpath</id>
    <content type="html"><![CDATA[<h1>Animating the Drawing of a CGPath With CAShapeLayer</h1>

<ul>
<li><a href="http://oleb.net/blog/2010/12/animating-drawing-of-cgpath-with-cashapelayer/">åŸæ–‡é“¾æ¥</a></li>
</ul>


<h1>è¿™æ˜¯ä»€ä¹ˆï¼Ÿ</h1>

<blockquote><p>æ­¤æ–‡å°†è®²è§£é€šè¿‡å½¢çŠ¶å›¾å±‚<code>CAShaperLayer</code>çš„<code>strokeStart</code>å’Œ<code>strokeEnd</code>æ¥å®ç°åŠ¨ç”»ç»˜åˆ¶è·¯å¾„<code>CGPath</code>,æ­¤æ–‡æ˜¯<a href="http://oleb.net">By Ole Begemann</a>åˆ›å»ºäºDecember 18, 2010,å½“æ—¶æ˜¯å‘å¸ƒiOS SDK 4.2æ—¶<code>CAShapeLayer</code>æ–°å¢åŠ çš„ä¸¤ä¸ªå±æ€§<a href="http://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAShapeLayer_class/Reference/Reference.html#//apple_ref/doc/uid/TP40008314-CH1-SW16">strokeStart</a>å’Œ<a href="http://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/CAShapeLayer_class/Reference/Reference.html#//apple_ref/doc/uid/TP40008314-CH1-SW15">strokeEnd</a>,è¿™ä¸¤ä¸ªå€¼æ˜¯ä¸¤ä¸ªæµ®ç‚¹æ•°å–å€¼èŒƒå›´0.0~1.0,ç”¨æ¥è¡¨æ˜å½¢çŠ¶å›¾å±‚æ‰€æŒ‡å‘çš„è·¯å¾„åœ¨ç»˜åˆ¶å¼€å§‹å’Œç»“æŸè·¯å¾„ä¸­çš„ç›¸å¯¹ä½ç½®ã€‚</p></blockquote>

<p><code>strokeStart</code>é»˜è®¤å€¼æ˜¯0.0ï¼Œ<code>strokeEnd</code>é»˜è®¤å€¼æ˜¯1.0ï¼Œæ˜¾ç„¶è¿™ä¼šå¯¼è‡´å½¢çŠ¶å›¾å±‚çš„è·¯å¾„å°†ä¸€æ•´ä¸ªè¢«ç»˜åˆ¶ã€‚å‡å¦‚ï¼Œä½ æƒ³è¯´ï¼Œå¦‚æœè®¾ç½®äº†layer.strokeEnd = 0.5f,åªè®©å¥¹ç»˜åˆ¶å‰åŠéƒ¨åˆ†ï¼Œé‚£è¯¥å¤šå¥½ã€‚</p>

<p>çœŸæ­£æœ‰è¶£çš„äº‹æƒ…æ˜¯è¿™äº›æ¥å£éƒ½æ˜¯å¯åŠ¨ç”»çš„ã€‚é€šè¿‡åŠ¨ç”»ç»˜åˆ¶<code>strokeEnd</code>ä»0.0åˆ°1.0åœ¨å‡ ç§’å†…ï¼Œæˆ‘ä»¬å°±èƒ½å¾ˆå®¹æ˜“è‡ªå·±ç»˜åˆ¶è·¯å¾„åƒä¸‹é¢è¿™æ ·å†™ï¼š</p>

<pre><code class="objective-c">CABasicAnimation *pathAnimation = [CABasicAnimation animationWithKeyPath:@"strokeEnd"];
pathAnimation.duration = 10.0;
pathAnimation.fromValue = [NSNumber numberWithFloat:0.0f];
pathAnimation.toValue = [NSNumber numberWithFloat:1.0f];
[self.pathLayer addAnimation:pathAnimation forKey:@"strokeEndAnimation"];
</code></pre>

<p>æœ€åï¼Œå†æ·»åŠ ç¬¬äºŒä¸ªå›¾å±‚åŒ…å«ä¸€ä¸ªé“…ç¬”å›¾ç‰‡ï¼Œä½¿ç”¨å…³é”®å¸§åŠ¨ç”»<code>CAKeyframeAnimation</code>æ¥è®©å®ƒéšç€è¿™ä¸ªè·¯å¾„ä»¥ç›¸åŒçš„é€Ÿåº¦ç»˜åˆ¶ï¼Œå°±å¯ä»¥è¾¾åˆ°å®Œç¾çš„é”™è§‰æ•ˆæœï¼š</p>

<pre><code class="objective-c">CAKeyframeAnimation *penAnimation = [CAKeyframeAnimation animationWithKeyPath:@"position"];
penAnimation.duration = 10.0;
penAnimation.path = self.pathLayer.path;
penAnimation.calculationMode = kCAAnimationPaced;
[self.penLayer addAnimation:penAnimation forKey:@"penAnimation"];
</code></pre>

<p><a href="http://oleb.net/media/AnimatedPathsHausVomNikolaus.mp4">ç»˜åˆ¶æ™®é€šè·¯å¾„æ•ˆæœè§†é¢‘</a></p>

<p><a href="http://oleb.net/media/AnimatedPathsHausVomNikolaus.mp4">ä¸‹è½½åœ°å€</a></p>

<p>è¿™ä¸ªå¯¹æ–‡æœ¬ä¸€æ ·æœ‰æ•ˆï¼›æˆ‘ä»¬åªéœ€è¦æŠŠå­—ç¬¦è½¬åŒ–æˆ<code>CGPath</code>ã€‚<code>Core Text</code>æä¾›äº†é‚£æ ·çš„åŠŸèƒ½çš„å‡½æ•°ï¼Œ<a href="http://developer.apple.com/library/ios/documentation/Carbon/Reference/CTFontRef/Reference/reference.html#//apple_ref/c/func/CTFontCreatePathForGlyph">CTFontCreatePathForGlyph( )</a>ã€‚ä¸ºäº†ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¸¦å±æ€§çš„å­—ç¬¦ä¸²ç”¨æˆ‘ä»¬æƒ³è¦æ¸²æŸ“çš„æ–‡æœ¬ï¼Œå…ˆæŠŠå®ƒä»¬åˆ†å‰²æˆè¡Œåœ¨åˆ†å‰²æˆä¸€ä¸ªä¸ªå­—ç¬¦ã€‚åœ¨æŠŠæ‰€æœ‰çš„å­—ç¬¦è½¬æ¢æˆè·¯å¾„åï¼Œæˆ‘ä»¬ä»¥å­è·¯å¾„æ–¹å¼æŠŠå®ƒæ·»åŠ åˆ°ä¸€ä¸ªå•ä¸ªçš„<code>CGPath</code>è·¯å¾„ä¸­ã€‚æ›´å¤šç»†èŠ‚å¯ä»¥æŸ¥çœ‹<a href="http://www.codeproject.com/script/Membership/View.aspx?mid=2887692">Ohmu</a>å†™çš„<a href="http://www.codeproject.com/KB/iPhone/Glyph.aspx">Low-level text rendering</a>è¿™ç¯‡æ–‡ç« ã€‚ç»“æœçœ‹ä»¥æ¥éå¸¸çš„ç‚«é…·ï¼š</p>

<p><a href="http://oleb.net/media/AnimatedPathsHelloWorld.mp4">ç»˜åˆ¶æ–‡å­—è·¯å¾„æ•ˆæœè§†é¢‘</a></p>

<p><a href="http://oleb.net/media/AnimatedPathsHelloWorld.mp4">ä¸‹è½½åœ°å€</a></p>

<p>ä»Githubä¸Šè·å¾—<a href="http://github.com/ole/Animated-Paths">iPadç‰ˆçš„æ ·å“å·¥ç¨‹</a></p>

<h1>ä½ å°†å­¦åˆ°çš„çŸ¥è¯†ç‚¹</h1>

<ul>
<li>ä½¿ç”¨<code>CAShapeLayer</code>çš„<code>strokeStart</code>å’Œ<code>strokeEnd</code>æ¥å®ç°è·¯å¾„åŠ¨ç”»,æ¯”è¾ƒé«˜çº§å¤æ‚çš„æ•ˆæœåƒgoogleçš„ä¸‹æ‹‰åˆ·æ–°è½¬åœˆå°±å¯ä»¥ä»è¿™é‡Œå¼•ç”³å»å®ç°ã€‚</li>
<li><code>CABasicAnimation</code>å’Œ<code>CABasicAnimation</code>ä½¿ç”¨</li>
<li>æ·±å…¥ç†è§£<code>CAShapeLayer</code>å’Œ<code>CALayer</code></li>
<li>é€šè¿‡æ–‡æœ¬åˆ›å»ºè·¯å¾„ï¼Œæ ¸å¿ƒå‡½æ•°<code>CTFontCreatePathForGlyph()</code></li>
</ul>


<h1>è¡¥å……è¯´æ˜</h1>

<pre><code class="objective-c">    CAShapeLayer *pathLayer = [CAShapeLayer layer];
    pathLayer.frame = self.animationLayer.bounds;
    pathLayer.bounds = pathRect;
    pathLayer.geometryFlipped = YES;
    pathLayer.path = path.CGPath;
    pathLayer.strokeColor = [[UIColor blackColor] CGColor];
    pathLayer.fillColor = nil;
    pathLayer.lineWidth = 10.0f;
    pathLayer.lineJoin = kCALineJoinBevel;

    [self.animationLayer addSublayer:pathLayer];
</code></pre>

<p>æœ‰ä¸€ç‚¹éå¸¸é‡è¦ï¼ŒCALayeråœ¨iOSç³»ç»Ÿä¸­ç›¸å¯¹åæ ‡ç³»æ˜¯ä»¥å±å¹•å·¦ä¸Š<code>top-left</code>ä¸ºåæ ‡åŸç‚¹çš„ï¼Œåœ¨Mac OS Xä¸Šä»¥åä¸‹<code>bottom-left</code>ä¸ºåæ ‡åŸç‚¹,ä½†æ˜¯å¯ä»¥é€šè¿‡<code>CALayer</code>çš„æ¥å£<code>geometryFlipped</code>å‚ç›´ç¿»è½¬åæ ‡ç³»ï¼Œè¿™ä¸ªå€¼é»˜è®¤æ˜¯<code>NO</code>ï¼Œè®¾ç½®æˆ<code>YES</code>å°±å¯ä»¥æŠŠåæ ‡ç³»è½¬æ¢æˆå·¦ä¸‹<code>bottom-left</code>äº†ï¼Œè¿™é‡Œä½œè€…ä½¿ç”¨çš„å·¦ä¸‹<code>bottom-left</code>çš„åæ ‡ç³»ã€‚</p>

<pre><code class="objective-c">@property(getter=isGeometryFlipped) BOOL geometryFlipped;
</code></pre>

<p>å…³äºè¿™ä¸ªå±æ€§ä½¿ç”¨æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„</p>

<ol>
<li>ç¿»è½¬ä¼šåŒæ—¶ä½œç”¨äºå®ƒçš„å­å›¾å±‚</li>
<li>å³ä½¿è¿™ä¸ªå±æ€§è®¾ç½®æˆ<code>YES</code>,å›¾ç‰‡çš„<code>orientation</code>ä»ç„¶æ˜¯ä¸å˜çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´å½“è®¾ç½®<code>flipped=YES</code>å’Œ<code>flipped=NO</code>æ—¶ä¸€ä¸ª<code>CGImageRef</code>å‚¨å­˜åœ¨<code>contents</code>æ¥å£ä¸­çš„å†…å®¹å°†ä¼šæ˜¾ç¤ºä¸€è‡´ï¼Œèµ‹å€¼å¹¶ä¸ä¼šçœŸæ­£å˜æ¢åº•å±‚çš„å›¾å±‚ï¼‰</li>
</ol>


<h3>pathLayeråŠ¨ç”»å®ç°åŸç†</h3>

<ol>
<li>å…ˆåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç”¨çš„å›¾å±‚<code>animationLayer</code>ç±»å‹<code>CALayer</code>ï¼Œç”¨æ¥å……å½“åŠ¨ç”»çš„ç”»å¸ƒã€‚</li>
<li>åˆ›å»ºçœŸæ­£çš„è·¯å¾„å›¾å±‚<code>pathLayer</code>ç±»å‹ä¸º<code>CAShapeLayer</code>,è®©å®ƒçš„åæ ‡ç³»å‚ç›´ç¿»è½¬ï¼Œå¹¶ä¸”è®©å›¾å±‚å®½é«˜åŒæ—¶å‘å†…æ”¶ç¼©100ä¸ªç‚¹,é€šè¿‡<code>CGRectInset(CGRect rect, CGFloat dx, CGFloat dy)</code>å®ç°</li>
<li>æŠŠ<code>pathLayer</code>æ·»åŠ åˆ°<code>animationLayer</code>çš„å­å›¾å±‚ä¸­å»</li>
<li>åˆ›å»ºä¸€ä¸ªé“…ç¬”å›¾å±‚<code>penLayer</code>ç±»å‹ä¸º<code>CALayer</code>,æŠŠå®ƒæ·»åŠ åˆ°<code>pathLayer</code>å»</li>
<li>å¯¹<code>pathLayer</code>æ·»åŠ <code>CABasicAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>strokeEnd</code></li>
<li>å¯¹<code>penLayer</code>æ·»åŠ <code>CAKeyframeAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>position</code></li>
</ol>


<h3>textLayeråŠ¨ç”»å®ç°åŸç†</h3>

<ol>
<li>å…ˆåˆ›å»ºä¸€ä¸ªåŠ¨ç”»ç”¨çš„å›¾å±‚<code>animationLayer</code>ç±»å‹<code>CALayer</code>ï¼Œç”¨æ¥å……å½“åŠ¨ç”»çš„ç”»å¸ƒ</li>
<li>Create path from text,See:<a href="http://www.codeproject.com/KB/iPhone/Glyph.aspx">http://www.codeproject.com/KB/iPhone/Glyph.aspx</a>ï¼Œæœ€ç»ˆä¿å­˜åˆ°ä¸€ä¸ªç±»å‹ä¸º<code>CGMutablePathRef</code>çš„letterä¸­</li>
<li>é€šè¿‡letteræ¥åˆ›å»ºæ–‡å­—<code>UIBezierPath</code>ç±»å‹çš„<code>path</code></li>
<li>é€šè¿‡pathå†åˆ›å»º<code>CAShapeLayer</code>pathLayer,å¹¶ä¸”æŠŠpathLayeræ·»åŠ åˆ°<code>animationLayer</code>ä¸­å»</li>
<li>åˆ›å»ºä¸€ä¸ªé“…ç¬”å›¾å±‚<code>penLayer</code>ç±»å‹ä¸º<code>CALayer</code>,æŠŠå®ƒæ·»åŠ åˆ°<code>pathLayer</code>å»</li>
<li>å¯¹<code>pathLayer</code>æ·»åŠ <code>CABasicAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>strokeEnd</code></li>
<li>å¯¹<code>penLayer</code>æ·»åŠ <code>CAKeyframeAnimation</code>åŠ¨ç”»ï¼ŒåŠ¨ç”»å±æ€§ä¸º<code>position</code></li>
</ol>


<h3>ä¿®å¤ä¸€å¤„bug</h3>

<p>é‡å¤ç‚¹å‡»<code>UISegmentedControl</code>å¯¼è‡´é“…ç¬”æ¶ˆå¤±ï¼Œè¿™æ˜¯è®¾ç½®äº†<code>penAnimation.delegate = self;</code>åœ¨ä»£ç†æ–¹æ³•é‡Œé¢æ²¡æœ‰åˆ¤æ–­ç»“æŸç›´æ¥å°†è®¾ç½®<code>self.penLayer.hidden = YES</code>ï¼Œå¯¼è‡´è¿ç»­åˆ‡æ¢æ—¶é“…ç¬”ä¸è§äº†ï¼Œè¦ä¿®å¤è¿™ä¸ªbugåªéœ€åŠ ä¸€ä¸ªåˆ¤æ–­<code>   if (flag)   self.penLayer.hidden = YES;
</code>å³å¯,è¿™æ ·çš„æ„æ€æ˜¯åªæœ‰å½“åŠ¨ç”»å®Œæˆæ—¶æ‰è®¾ç½®<code>self.penLayer.hidden</code>çš„å€¼ï¼Œå¥½äº†ç°åœ¨å·²ç»éå¸¸å®Œç¾äº†ï¼Œå¿«å»åŠ¨æ‰‹è‡ªå·±è¯•è¯•å§ï¼ğŸº</p>
]]></content>
  </entry>
  
</feed>
